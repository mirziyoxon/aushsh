<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Books - The UCN Times</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; background:#f9f9f9; }
  header { background:#222; color:white; padding:10px 20px; position:relative; }
  nav { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; }
  .nav-left { font-weight:bold; font-size:18px; }
  .nav-right { display:flex; gap:15px; }
  .nav-right a { color:white; text-decoration:none; font-size:1rem; }
  .nav-right a:hover { text-decoration:underline; }
  .menu-btn { display:none; flex-direction:column; cursor:pointer; gap:5px; }
  .menu-btn div { width:25px; height:3px; background:white; border-radius:2px; transition:.3s; }

  @media (max-width:768px){
    .nav-right { display:none; flex-direction:column; width:100%; background:#222; padding:15px 0; }
    .nav-right.active { display:flex; }
    .menu-btn { display:flex; }
  }

  main { padding:20px; }
  .container { max-width:900px; margin:30px auto; padding:20px; background:white; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,.1); }
  li { margin:12px 0; font-size:18px; }
  a { text-decoration:none; color:#111; font-weight:bold; transition:.3s; cursor:pointer; }
  a:hover { color:#0073e6; }

  /* Modal */
  .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:10000; }
  .modal-content { background:white; padding:20px; border-radius:8px; width:90%; max-width:400px; }
  .modal-content h2 { margin-top:0; }
  .modal-content input[type=text], .modal-content input[type=email], .modal-content input[type=tel], .modal-content input[type=number] {
    width:100%; padding:8px; margin:8px 0; border:1px solid #ccc; border-radius:4px;
  }
  .modal-content label { display:flex; align-items:center; gap:5px; margin:5px 0; }
  .modal-content button { background:#0073e6; color:white; border:none; padding:10px 15px; border-radius:5px; cursor:pointer; }
  .modal-content button:hover { background:#005bb5; }

  /* Splash screen */
  #splash { position:fixed; top:0; left:0; width:100%; height:100%; background:white; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:bold; z-index:1000; }
  .loader { border:8px solid #f3f3f3; border-top:8px solid #333; border-radius:50%; width:60px; height:60px; animation:spin 1.2s linear infinite; }
  @keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } }
</style>
</head>
<body>

<div id="splash">
  <div class="loader"></div>
</div>

<header>
  <nav>
    <div class="nav-left">Reader @ Books</div>
    <div class="menu-btn" onclick="toggleMenu()">
      <div></div>
      <div></div>
      <div></div>
    </div>
    <div class="nav-right" id="navLinks">
      <a href="https://unicorner.uz">Home</a>
      <a href="https://unicorner.uz/about">About</a>
      <a href="https://research.unicorner.uz">Research</a>
      <a href="https://article.unicorner.uz">Articles</a>
      <a href="https://unicorner.uz/publish">Publish</a>
    </div>
  </nav>
</header>

<main id="content">
  <h1>All Books</h1>
  <div class="container">
    <ul id="bookList">
      <li><a data-src="books/Atomic Habits - unicorner.uz.pdf">Book 1: Atomic Habits - James Clear</a></li>
      <li><a data-src="books/bell-alexander-graham - unicorner.uz.pdf">Book 2: Alexander Graham Bell - Harodl S. Osborne</a></li>
      <li><a data-src="books/History Of English Literature (2000) - unicorner.uz.pdf">Book 3: History Of English Literature (2000) - Edward Albert</a></li>
      <li><a data-src="books/Homes Odyssey - unicorner.uz.pdf">Book 4: Homes Odyssey - Ian Johnston</a></li>
    </ul>
  </div>
</main>

<!-- Register Modal -->
<div class="modal" id="registerModal">
  <div class="modal-content" id="modalContent">
    <h2>Register to Access Books</h2>
    <div id="step1">
      <input type="text" id="fname" placeholder="First Name">
      <input type="text" id="lname" placeholder="Last Name">
      <input type="tel" id="phone" placeholder="Phone Number">
      <input type="email" id="email" placeholder="Email">
      <label><input type="checkbox" id="agree"> I agree to terms & conditions</label>
      <button onclick="sendVerification()">Submit</button>
    </div>
    <div id="step2" style="display:none;">
      <p>Enter verification code sent to your email:</p>
      <input type="number" id="verCode" placeholder="Verification Code">
      <button onclick="checkCode()">Verify</button>
    </div>
    <p id="modalMsg"></p>
  </div>
</div>

<script src="https://cdn.emailjs.com/dist/email.min.js"></script>
<script>
emailjs.init("U61qjjpdisn3tPolI"); // <-- EmailJS user ID

// Splash screen
setTimeout(() => { document.getElementById("splash").style.display="none"; document.getElementById("content").style.display="block"; }, 2000);

// Hamburger toggle
function toggleMenu(){ document.getElementById("navLinks").classList.toggle("active"); }

// Check if already registered
let registeredUser = JSON.parse(localStorage.getItem("registeredUser"));
if(registeredUser){
  unlockBooks();
}

// Click on book
document.querySelectorAll("#bookList a").forEach(link=>{
  link.addEventListener("click", function(e){
    if(!registeredUser){
      e.preventDefault();
      document.getElementById("registerModal").style.display="flex";
      currentLink = link; // save clicked link
    }
  });
});

let verificationCode = Math.floor(100000 + Math.random()*900000);
let currentLink = null;
let attempts = JSON.parse(localStorage.getItem("attempts")) || {count:0, blockedUntil:null};

// Send EmailJS code
function sendVerification(){
  const fname = document.getElementById("fname").value.trim();
  const lname = document.getElementById("lname").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const email = document.getElementById("email").value.trim();
  const agree = document.getElementById("agree").checked;

  if(!fname || !lname || !phone || !email || !agree){
    alert("Please fill all fields and accept terms");
    return;
  }

  // Send email via EmailJS
  emailjs.send("service_ob14lw2","template_inq4rb4",{
    fname: fname,
    lname: lname,
    phone: phone,
    email: email,
    code: verificationCode
  }).then(res=>{
    document.getElementById("step1").style.display="none";
    document.getElementById("step2").style.display="block";
  }, err=>{
    alert("Failed to send email, try again.");
  });
}

// Check verification code
function checkCode(){
  const code = document.getElementById("verCode").value;
  const now = new Date().getTime();

  if(attempts.blockedUntil && now<attempts.blockedUntil){
    alert("Too many attempts. Try later.");
    return;
  }

  if(code == verificationCode){
    alert("You have successfully registered!");
    const user = {
      fname: document.getElementById("fname").value.trim(),
      lname: document.getElementById("lname").value.trim(),
      email: document.getElementById("email").value.trim(),
      phone: document.getElementById("phone").value.trim()
    };
    localStorage.setItem("registeredUser", JSON.stringify(user));
    document.getElementById("registerModal").style.display="none";
    registeredUser = user;
    unlockBooks();
    attempts = {count:0, blockedUntil:null};
    localStorage.setItem("attempts", JSON.stringify(attempts));
  }else{
    attempts.count++;
    localStorage.setItem("attempts", JSON.stringify(attempts));
    if(attempts.count>=3){
      attempts.blockedUntil = new Date().getTime() + 24*60*60*1000;
      localStorage.setItem("attempts", JSON.stringify(attempts));
      alert("Too many failed attempts. Try after 24 hours.");
      document.getElementById("registerModal").style.display="none";
    }else{
      alert("Incorrect code. Retry.");
    }
  }
}

// Unlock books
function unlockBooks(){
  document.querySelectorAll("#bookList a").forEach(link=>{
    const realSrc = link.getAttribute("data-src");
    link.setAttribute("href", realSrc);
    link.setAttribute("target","_blank");
  });
}
</script>
</body>
</html>
